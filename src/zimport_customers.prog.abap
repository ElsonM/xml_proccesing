************************************************************************
* Program:        ZIMPORT_CUSTOMERS                                    *
* Request ID:     RXXXXXX                                              *
* User ID:        ELSONMECO                                            *
* Date:           24.10.2017                                           *
* Description:    -                                                    *
************************************************************************
REPORT zimport_customers.

************************************************************************
* GLOBAL DATA DEFINITIONS                                              *
************************************************************************
*----------------------------------------------------------------------*
* INCLUDE - definitions                                                *
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
* CONSTANT - definitions                                               *
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
* TYPE - definitions                                                   *
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
* DDIC - TABLE / STRUCTURE / VIEW definitions                          *
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
* STRUCTURE definitions                                                *
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
* RANGE definitions                                                    *
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
* REFERENCE definitions                                                *
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
* INTERNAL TABLE definitions                                           *
*----------------------------------------------------------------------*
DATA customers TYPE zcustomer_tt.

*----------------------------------------------------------------------*
* OTHER GLOBAL DATA definitions                                        *
*----------------------------------------------------------------------*
DATA customers_xml TYPE string.

************************************************************************
* GLOBAL DATA DEFINITIONS - END                                        *
************************************************************************

************************************************************************
* SELECTION SCREENS                                                    *
************************************************************************
************************************************************************
* SELECTION SCREENS - END                                              *
************************************************************************

************************************************************************
* EVENTS                                                               *
************************************************************************
*----------------------------------------------------------------------*
* INITIALIZATON event                                                  *
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
* AT SELECTION-SCREEN ON VALUE-REQUEST FOR event                       *
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
* START-OF-SELECTION event                                             *
*----------------------------------------------------------------------*
START-OF-SELECTION.
  PERFORM upload_xml CHANGING customers_xml.

  PERFORM parse_xml  USING    customers_xml
                     CHANGING customers.

  PERFORM insert_into_database USING customers.

*----------------------------------------------------------------------*
* END-OF-SELECTION event                                               *
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
* AT LINE-SELECTION event                                              *
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
* AT USER-COMMAND event                                                *
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
* TOP-OF-PAGE event                                                    *
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
* END-OF-PAGE event                                                    *
*----------------------------------------------------------------------*
************************************************************************
* EVENTS - END                                                         *
************************************************************************

************************************************************************
* SUBROUTINES                                                          *
************************************************************************
*&---------------------------------------------------------------------*
FORM upload_xml CHANGING customers_xml.
*&---------------------------------------------------------------------*
  DATA xml_content_table TYPE TABLE OF string.
  DATA xml_content_line  TYPE          string.

  CALL FUNCTION 'GUI_UPLOAD'
    EXPORTING
      filename = 'C:\customers.xml'
    TABLES
      data_tab = xml_content_table.

  LOOP AT xml_content_table INTO xml_content_line.
    CONCATENATE customers_xml xml_content_line INTO customers_xml.
  ENDLOOP.
ENDFORM.                    " UPLOAD_XML



*&---------------------------------------------------------------------*
FORM parse_xml USING    customers_xml TYPE string
               CHANGING customers     TYPE zcustomer_tt.
*&---------------------------------------------------------------------*
  CALL TRANSFORMATION zcustomer_st
    SOURCE XML customers_xml
    RESULT     customers = customers.
ENDFORM.                    " PARSE_XML

*&---------------------------------------------------------------------*
FORM insert_into_database USING customers TYPE zcustomer_tt.
*&---------------------------------------------------------------------*
  INSERT zcustomer_xml FROM TABLE customers.
ENDFORM.                    " INSERT_INTO_DATABASE
